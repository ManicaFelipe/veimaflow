openapi: 3.0.0
info:
  title: VEIMANFLOW API
  version: 1.0.0
  description: API para o sistema de gerenciamento de fluxo de trabalho VEIMANFLOW

servers:
  - url: http://localhost:3000/api
    description: Servidor de desenvolvimento (proxy Vite)
  - url: http://localhost:8080/api
    description: Backend Spring Boot (dev)

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        email:
          type: string
          format: email

    Board:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        ownerId:
          type: string
          format: uuid

    Card:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        status:
          type: string
          enum: [todo, doing, done]
        boardId:
          type: string
          format: uuid

    # --- Backend Spring (VemaFlow) ---
    SlaStatus:
      type: object
      properties:
        status: { type: string }
        tempoSegundos: { type: integer, format: int64 }
        tempoFormatado: { type: string }
    TarefaSla:
      type: object
      properties:
        tarefaId: { type: integer, format: int64 }
        tituloTarefa: { type: string }
        statusAtual: { type: string }
        tempoTotalSegundos: { type: integer, format: int64 }
        tempoTotalFormatado: { type: string }
        temposPorStatus:
          type: array
          items: { $ref: '#/components/schemas/SlaStatus' }
    Dashboard:
      type: object
      properties:
        totalTarefas: { type: integer, format: int64 }
        tarefasPendentes: { type: integer, format: int64 }
        tarefasEmAndamento: { type: integer, format: int64 }
        tarefasConcluidas: { type: integer, format: int64 }
        tarefasVencidas: { type: integer, format: int64 }
        leadTimeMediaDias: { type: number, format: double }
        cycleTimeMediaDias: { type: number, format: double }
        wip: { type: integer, format: int64 }
    DashboardExecutivoItem:
      type: object
      properties:
        projetoId: { type: integer, format: int64 }
        projetoNome: { type: string }
        totalTarefas: { type: integer, format: int64 }
        tarefasPendentes: { type: integer, format: int64 }
        tarefasEmAndamento: { type: integer, format: int64 }
        tarefasConcluidas: { type: integer, format: int64 }
        tarefasVencidas: { type: integer, format: int64 }
        rag: { type: string, enum: [R, A, G] }

paths:
  /auth/login:
    post:
      summary: Autenticar usuário
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
      responses:
        '200':
          description: Login bem sucedido
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                  user:
                    $ref: '#/components/schemas/User'

  /auth/register:
    post:
      summary: Registrar novo usuário
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                email:
                  type: string
                  format: email
                password:
                  type: string
      responses:
        '201':
          description: Usuário criado
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                  user:
                    $ref: '#/components/schemas/User'

  /boards:
    get:
      summary: Listar quadros
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de quadros
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Board'

    post:
      summary: Criar novo quadro
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
      responses:
        '201':
          description: Quadro criado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Board'

  /boards/{boardId}/cards:
    get:
      summary: Listar cartões de um quadro
      security:
        - bearerAuth: []
      parameters:
        - name: boardId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Lista de cartões
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Card'

    post:
      summary: Criar novo cartão
      security:
        - bearerAuth: []
      parameters:
        - name: boardId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                description:
                  type: string
                status:
                  type: string
                  enum: [todo, doing, done]
      responses:
        '201':
          description: Cartão criado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Card'

  /tarefas/{id}/sla:
    get:
      summary: Obter SLA (tempo em cada status) da tarefa
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: { $ref: '#/components/schemas/TarefaSla' }
              examples:
                exemplo:
                  value:
                    tarefaId: 123
                    tituloTarefa: "Implementar autenticação"
                    statusAtual: "EM_ANDAMENTO"
                    tempoTotalSegundos: 172800
                    tempoTotalFormatado: "2d"
                    temposPorStatus:
                      - status: "NAO_INICIADO"
                        tempoSegundos: 86400
                        tempoFormatado: "1d"
                      - status: "EM_ANDAMENTO"
                        tempoSegundos: 86400
                        tempoFormatado: "1d"

  /dashboard:
    get:
      summary: Obter métricas de dashboard
      parameters:
        - in: query
          name: projetoId
          required: false
          schema: { type: integer, format: int64 }
          description: Filtra métricas por projeto
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Dashboard' }
              examples:
                exemplo:
                  value:
                    totalTarefas: 120
                    tarefasPendentes: 30
                    tarefasEmAndamento: 50
                    tarefasConcluidas: 38
                    tarefasVencidas: 2
                    leadTimeMediaDias: 5.4
                    cycleTimeMediaDias: 3.2
                    wip: 12

  /tarefas/{tarefaId}/anexos:
    get:
      summary: Listar anexos da tarefa
      parameters:
        - in: path
          name: tarefaId
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id: { type: integer, format: int64 }
                    nomeArquivo: { type: string }
                    contentType: { type: string }
                    tamanho: { type: integer, format: int64 }
                    criadoEm: { type: string, format: date-time }
                    tarefaId: { type: integer, format: int64 }
    post:
      summary: Upload de anexo para tarefa
      parameters:
        - in: path
          name: tarefaId
          required: true
          schema: { type: integer, format: int64 }
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '201':
          description: Criado
          content:
            application/json:
              schema:
                type: object
                properties:
                  id: { type: integer, format: int64 }
                  nomeArquivo: { type: string }
                  contentType: { type: string }
                  tamanho: { type: integer, format: int64 }
                  criadoEm: { type: string, format: date-time }
                  tarefaId: { type: integer, format: int64 }

  /anexos/{id}/download:
    get:
      summary: Download de anexo
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '200':
          description: OK
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary

  /anexos/{id}:
    delete:
      summary: Remover anexo
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '204':
          description: Sem conteúdo

  /dashboard/executivo:
    get:
      summary: Obter resumo executivo (R/A/G) por projeto
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/DashboardExecutivoItem' }
              examples:
                exemplo:
                  value:
                    - projetoId: 1
                      projetoNome: "Projeto A"
                      totalTarefas: 25
                      tarefasPendentes: 5
                      tarefasEmAndamento: 12
                      tarefasConcluidas: 7
                      tarefasVencidas: 1
                      rag: "A"
                    - projetoId: 2
                      projetoNome: "Projeto B"
                      totalTarefas: 10
                      tarefasPendentes: 0
                      tarefasEmAndamento: 2
                      tarefasConcluidas: 8
                      tarefasVencidas: 0
                      rag: "G"